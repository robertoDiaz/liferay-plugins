YUI.add("aui-image-editor",function(e,t){var n=e.Lang,r=e.Array,i="image-editor",s=".",o=e.getClassName,u=o("image-processor"),a=o("toolbar"),f=e.Component.create({NAME:i,HTML_PARSER:{processorNode:s+u,toolbarNode:s+a},ATTRS:{processorNode:{},toolbarNode:{},undo:{validator:n.isObject,value:{enabled:!0,levels:50}}},prototype:{FILTER_EDITOR_TPL:'<div class="filter-editor"></div>',initializer:function(){var e=this},renderUI:function(){var t=this;t._filterEditors=[],t._imageProcessor=t._renderImageProcessor(),t._toolbar=t._renderToolbar(t._imageProcessor),t._editorContainer=e.Node.create("<div></div>"),t.get("srcNode").append(t._editorContainer)},syncUI:function(){var e=this},getImageData:function(){var e=this;return e._imageProcessor.getImageData()},_renderImageProcessor:function(){var t=this,n=t.get("undo"),r;return r=new e.ImageProcessor({srcNode:t.get("processorNode"),plugins:[e.ImageAdjustFilter,e.ImageBlurFilter,e.ImageGrayscaleFilter,e.ImageSepiaFilter,e.ImagePolaroidFilter,e.ImageInvertFilter,e.ImageScaleFilter]}),n.enabled&&e.use("aui-image-processor-undo",function(){r.plug(e.ImageProcessorUndo)}),r},_renderToolbar:function(t){var n=this;return toolbar=new e.Toolbar({boundingBox:n.get("toolbarNode"),children:n._getToolbar(t),render:!0}),toolbar},_getOptions:function(t){var n=this,r=n.get("undo"),i=[],s;return r.enabled&&(s=[{icon:"icon-arrow-left",on:{click:e.bind("undo",t)}},{icon:"icon-arrow-right",on:{click:e.bind("redo",t)}}],i.push(s)),i.push([{icon:"icon-trash",on:{click:e.bind("reset",t)}}]),i},_getFiltersToolbar:function(){var t=this,n=["radio",{icon:"icon-adjust",filters:[e.ImageAdjustFilter],on:{click:e.rbind("_editFilter",t,"adjustFilter")}},{icon:"icon-picture",filters:[e.ImageGrayscaleFilter,e.ImageSepiaFilter,e.ImagePolaroidFilter,e.ImageInvertFilter],on:{click:e.rbind("_editFilter",t,["grayscale","sepia","polaroid","invert"])}},{icon:"icon-wrench",filters:[e.ImageScaleFilter],on:{click:e.rbind("_editFilter",t,"scale")}}];return n},_getToolbar:function(e){var t=this,n=t._getOptions(e);return n.push(t._getFiltersToolbar()),n},_editFilter:function(t,i){var s=this,i=n.isArray(i)?i:[i],o=i.join(),u=s._filterEditors[o],a=u?u.editor:null,f;a?r.each(u.filters,function(e,t,n){f=s._imageProcessor[e],f&&f.resetEditor()}):(a=e.Node.create(s.FILTER_EDITOR_TPL),r.each(i,function(e,t,n){f=s._imageProcessor[e],f&&a.append(f.getEditor())}),s._editorContainer.append(a),s._filterEditors[o]={editor:a,filters:i}),s._imageProcessor.save(),s._editorContainer.all(".filter-editor").hide(),a.show()}}});e.ImageEditor=f},"2.0.0",{requires:["aui-image-color-filter","aui-image-blur-filter","aui-image-scale-filter","aui-image-processor","aui-toolbar","aui-widget"]});
