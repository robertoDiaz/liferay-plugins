YUI.add("aui-image-editor",function(e,t){var n=e.Lang,r=e.Object,i="image-editor-base",s="boundingBox",o=".image-editor-processors",u="img",a=".toolbar",f=".image-editor-trigger",l="image/jpeg",c="image/png",h=/\.([^.]*)$/,p=/jpe?g$/i,d="clear",v="click",m="imageNode",g="imageType",y="processors",b="processorsNode",w="redo",E="reset",S="save",x="toolbarNode",T="triggerNode",N="ui",C="undo",k="value",L=["gallery-undo","aui-image-editor-action"],A=e.Component.create({NAME:i,HTML_PARSER:{imageNode:u,processorsNode:o,toolbarNode:a,triggerNode:f},ATTRS:{imageNode:{setter:e.one},imageType:{validator:n.isString},processors:{},processorsNode:{setter:e.one},toolbarNode:{setter:e.one},triggerNode:{setter:e.one},undo:{validator:n.isObject,value:{enabled:!0,limit:0}}},prototype:{PROCESSORS_NODE_TPL:'<div class="image-editor-processors"><div class="image-processor-widgets"></div><div class="image-processor-toolbar"></div><div class="image-processor-status row-fluid"><button class="btn-cancel span1"><i class="icon-remove"></i></button><div class="image-processor-info span10"></div><button class="btn-ok span1"><i class="icon-ok"></i></button></div></div>',PROCESSOR_WIDGET_WRAPPER_TPL:'<div class="{cssClass}"></div>',TOOLBAR_NODE_TPL:'<div class="image-editor-toolbar hide"><div class="btn-group"><button class="btn" data-action="undo"><i class="icon-arrow-left"></i></button><button class="btn" data-action="redo"><i class="icon-arrow-right"></i></button></div><div class="btn-group btn-group-radio"><button class="btn" data-action="adjust"><i class="icon-adjust"></i></button><button class="btn" data-action="filters"><i class="icon-picture"></i></button><button class="btn" data-action="scale"><i class="icon-resize-small"></i></button></div></div>',TRIGGER_NODE_TPL:'<button class="image-editor-trigger image-editor-trigger-default"><i class="icon-edit"></i></button>',initializer:function(){var t=this,n,r,i,s,o,u;u=t.get(C),u.enabled&&e.use(L,e.bind("_createUndoManager",t,u)),r=t.get(m),s=t.get(g),s||(i=r.get("src"),s=c,h.test(i)&&(n=h.exec(i)[1],p.test(n)&&(s=l)),t.set(g,s)),o=t.get(y),o||(o=t._getDefaultProcessors(),t.set(y,o)),t._actions=t._getAvailableActions(o)},renderUI:function(){var e=this,t,n,r,i;i=e.get(T),i||(i=e._createTriggerNode()),r=e.get(x),r?n=e._renderToolbar(r):r=e._createToolbarNode(),t=e.get(b),t||(t=e._createProcessorsNode()),e._processorsNode=t,e._processorStatusNode=t.one(".image-processor-status"),e._processorInfo=e._processorStatusNode.one(".image-processor-info"),e._processorToolbarNode=t.one(".image-processor-toolbar"),e._processorWidgetsNode=t.one(".image-processor-widgets"),e._toolbar=n,e._toolbarNode=r,e._triggerNode=i},bindUI:function(){var t=this,n,r,i;r=[e.Do.after(t._resetUI,t,d,t),e.Do.after(t._resetUI,t,S,t)],r.push(t._triggerNode.on(v,e.bind("_showControls",t))),i=t._processorsNode.one(".btn-ok"),i&&r.push(i.on(v,e.bind(S,t))),n=t._processorsNode.one(".btn-cancel"),n&&r.push(n.on(v,e.bind(d,t))),t._toolbar&&r.push(t._bindToolbarUI()),t._eventHandles=r},destructor:function(){var t=this;(new e.EventHandle(t._eventHandles)).detach()},_bindToolbarUI:function(){var e=this,t;return t=e._toolbarNode.delegate(v,function(t){action=e._actions[t.currentTarget.getAttribute("data-action")],n.isFunction(action)&&action()},"button"),t},_createProcessorUIWrapper:function(t,r){var i=this,s,o;return o=i._processorWidgetsNode.appendChild(n.sub(i.PROCESSOR_WIDGET_WRAPPER_TPL,{cssClass:r})),s=e.instanceOf(t,e.Base)?t.get(N):t.ui,n.isObject(s)&&n.isFunction(s.fn)&&(widget=(new s.fn(s.cfg)).render(o),widget.on("valueChange",function(e){i.process(t,e.newVal)})),o.setData("widget",widget),o},_createProcessorsNode:function(){var t=this,n;return n=e.Node.create(t.PROCESSORS_NODE_TPL),t.get(s).append(n),n.hide(),n},_createToolbarNode:function(){var t=this,n;return n=e.Node.create(t.TOOLBAR_NODE_TPL),t.get(s).append(n),n},_createTriggerNode:function(){var t=this,n;return n=e.Node.create(t.TRIGGER_NODE_TPL),t.get(s).append(n),n},_createUndoManager:function(t){var n=this;n._undoManager=new e.UndoManager({limit:t.limit})},_getAvailableActions:function(t){var n=this,i;return i={clear:e.bind(d,n),redo:e.bind(w,n),reset:e.bind(E,n),save:e.bind(S,n),undo:e.bind(C,n)},r.each(t,function(t,r){i[r]=e.bind("_renderProcessorToolbar",n,t)}),i},_getDefaultProcessors:function(){var t;return t={adjust:{brightness:new e.ImageAdjustFilter({mode:"brightness"}),contrast:new e.ImageAdjustFilter({mode:"contrast"}),saturation:new e.ImageAdjustFilter({mode:"saturation"})},filters:{grayscale:new e.ImageGrayscaleFilter,sepia:new e.ImageSepiaFilter,polaroid:new e.ImagePolaroidFilter,invert:new e.ImageInvertFilter},scale:{"mirror-x":new e.ImageScaleFilter({scaleX:-1}),"mirror-y":new e.ImageScaleFilter({scaleY:-1})}},t},_getProcessorUIWrapper:function(e,t){var n=this,r,i,s;return r="image-processor-ui-"+t,s=n._processorWidgetsNode.one("."+r),s||(s=n._createProcessorUIWrapper(e,r)),i=s.getData("widget"),i&&(i.reset(),i.get(k)&&i.reset(k)),s},_notifyStateChange:function(t,n,r){var i=this,s;s="imageProcessor:"+t,i.fire(s,{newVal:r,prevVal:n}),i._undoManager&&t==="save"&&i._undoManager.add(new e.ImageEditorAction({editor:i,newVal:r,prevVal:n}))},undo:function(){var e=this;e._undoManager&&e._undoManager.undo()},redo:function(){var e=this;e._undoManager&&e._undoManager.redo()},_renderToolbar:function(t){var n;return n=(new e.Toolbar({boundingBox:t})).render(),n},_renderProcessorToolbar:function(t){var n=this,i=[];n.clear(),n._processorsNode.show(),n._processorToolbarNode.show(),n._toolbar.hide(),n._triggerNode.hide(),r.each(t,function(t,r){i.push({cssClass:"btn-image-processor btn-image-processor-"+r,label:r,on:{click:e.bind("_renderProcessorUI",n,t,r)}})}),n._processorToolbar=(new e.Toolbar({boundingBox:n._processorToolbarNode,children:i})).render()},_renderProcessorUI:function(t,n){var r=this,i,s;r._currentWrapper&&r._currentWrapper.hide(),r._processorStatusNode.show(),r._processorWidgetsNode.show(),r._processorToolbarNode.hide(),i=e.instanceOf
(t,e.Base)?t.get(N):t.ui,i?(s=r._getProcessorUIWrapper(t,n),s.show()):r.process(t),r._currentWrapper=s},_resetUI:function(){var e=this;e._processorStatusNode&&e._processorStatusNode.hide(),e._processorWidgetsNode&&e._processorWidgetsNode.hide(),e._triggerNode.show()},_showControls:function(){var e=this;e._triggerNode.hide(),e._toolbar||(e._toolbar=e._renderToolbar(e._toolbarNode),e._eventHandles.push(e._bindToolbarUI())),e._toolbar.show()}}});e.ImageEditorBase=A},"2.0.0",{requires:["aui-image-color-filter-base","aui-image-filter-adjust","aui-image-filter-grayscale","aui-image-filter-invert","aui-image-filter-polaroid","aui-image-filter-sepia","aui-image-blur-filter","aui-image-scale-filter","aui-toolbar","timers"],skinnable:!0});
